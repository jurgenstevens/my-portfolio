import{_ as fe}from"./@babel-34ca84e8.js";import{r as g}from"./react-d344b9d5.js";import{L as _e,T as xt,R as St,U as Ot,a as Rt,O as Le,P as Fe,S as Ge,b as Ee,N as jt,A as Tt,B as kt,M as At,C as Dt,V as U,c as Lt,d as Ft,W as zt,e as It,f as Ht,g as Wt,h as Bt,i as $t,D as Nt,j as he,k as ze,l as Gt,E as et,m as qt,n as Ut,o as Vt,p as Xt}from"./three-824df395.js";import{u as Yt}from"./react-use-measure-f6074b16.js";import{F as Zt,u as Kt}from"./its-fine-db4dbd27.js";import{R as Jt,c as ie}from"./react-reconciler-de1ac884.js";import{c as Qt}from"./react-dom-223a3bfd.js";import{c as tt}from"./zustand-cabf8f19.js";import{D as en,O as tn}from"./three-stdlib-4bafabab.js";import{m as nn}from"./react-merge-refs-239dbb3c.js";import{s as rn,p as on,c as sn}from"./suspend-react-00b64780.js";var nt={exports:{}},rt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(_,x){var C=_.length;_.push(x);e:for(;0<C;){var R=C-1>>>1,O=_[R];if(0<a(O,x))_[R]=x,_[C]=O,C=R;else break e}}function r(_){return _.length===0?null:_[0]}function i(_){if(_.length===0)return null;var x=_[0],C=_.pop();if(C!==x){_[0]=C;e:for(var R=0,O=_.length,W=O>>>1;R<W;){var L=2*(R+1)-1,V=_[L],$=L+1,ee=_[$];if(0>a(V,C))$<O&&0>a(ee,V)?(_[R]=ee,_[$]=C,R=$):(_[R]=V,_[L]=C,R=L);else if($<O&&0>a(ee,C))_[R]=ee,_[$]=C,R=$;else break e}}return x}function a(_,x){var C=_.sortIndex-x.sortIndex;return C!==0?C:_.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var h=Date,v=h.now();e.unstable_now=function(){return h.now()-v}}var s=[],m=[],o=1,n=null,f=3,u=!1,p=!1,P=!1,b=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,d=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(_){for(var x=r(m);x!==null;){if(x.callback===null)i(m);else if(x.startTime<=_)i(m),x.sortIndex=x.expirationTime,t(s,x);else break;x=r(m)}}function E(_){if(P=!1,y(_),!p)if(r(s)!==null)p=!0,q(M);else{var x=r(m);x!==null&&F(E,x.startTime-_)}}function M(_,x){p=!1,P&&(P=!1,l(T),T=-1),u=!0;var C=f;try{for(y(x),n=r(s);n!==null&&(!(n.expirationTime>x)||_&&!w());){var R=n.callback;if(typeof R=="function"){n.callback=null,f=n.priorityLevel;var O=R(n.expirationTime<=x);x=e.unstable_now(),typeof O=="function"?n.callback=O:n===r(s)&&i(s),y(x)}else i(s);n=r(s)}if(n!==null)var W=!0;else{var L=r(m);L!==null&&F(E,L.startTime-x),W=!1}return W}finally{n=null,f=C,u=!1}}var S=!1,k=null,T=-1,j=5,A=-1;function w(){return!(e.unstable_now()-A<j)}function D(){if(k!==null){var _=e.unstable_now();A=_;var x=!0;try{x=k(!0,_)}finally{x?B():(S=!1,k=null)}}else S=!1}var B;if(typeof d=="function")B=function(){d(D)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,H=Y.port2;Y.port1.onmessage=D,B=function(){H.postMessage(null)}}else B=function(){b(D,0)};function q(_){k=_,S||(S=!0,B())}function F(_,x){T=b(function(){_(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(_){_.callback=null},e.unstable_continueExecution=function(){p||u||(p=!0,q(M))},e.unstable_forceFrameRate=function(_){0>_||125<_?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<_?Math.floor(1e3/_):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(s)},e.unstable_next=function(_){switch(f){case 1:case 2:case 3:var x=3;break;default:x=f}var C=f;f=x;try{return _()}finally{f=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(_,x){switch(_){case 1:case 2:case 3:case 4:case 5:break;default:_=3}var C=f;f=_;try{return x()}finally{f=C}},e.unstable_scheduleCallback=function(_,x,C){var R=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?R+C:R):C=R,_){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=C+O,_={id:o++,callback:x,priorityLevel:_,startTime:C,expirationTime:O,sortIndex:-1},C>R?(_.sortIndex=C,t(m,_),r(s)===null&&_===r(m)&&(P?(l(T),T=-1):P=!0,F(E,C-R))):(_.sortIndex=O,t(s,_),p||u||(p=!0,q(M))),_},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(_){var x=f;return function(){var C=f;f=x;try{return _.apply(this,arguments)}finally{f=C}}}})(rt);nt.exports=rt;var qe=nt.exports;const Ie={},an=e=>void Object.assign(Ie,e);function ln(e,t){function r(o,{args:n=[],attach:f,...u},p){let P=`${o[0].toUpperCase()}${o.slice(1)}`,b;if(o==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=u.object;b=re(l,{type:o,root:p,attach:f,primitive:!0})}else{const l=Ie[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");b=re(new l(...n),{type:o,root:p,attach:f,memoizedProps:{args:n}})}return b.__r3f.attach===void 0&&(b instanceof kt?b.__r3f.attach="geometry":b instanceof At&&(b.__r3f.attach="material")),P!=="inject"&&Ce(b,u),b}function i(o,n){let f=!1;if(n){var u,p;(u=n.__r3f)!=null&&u.attach?Me(o,n,n.__r3f.attach):n.isObject3D&&o.isObject3D&&(o.add(n),f=!0),f||(p=o.__r3f)==null||p.objects.push(n),n.__r3f||re(n,{}),n.__r3f.parent=o,Ae(n),oe(n)}}function a(o,n,f){let u=!1;if(n){var p,P;if((p=n.__r3f)!=null&&p.attach)Me(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){n.parent=o,n.dispatchEvent({type:"added"});const b=o.children.filter(d=>d!==n),l=b.indexOf(f);o.children=[...b.slice(0,l),n,...b.slice(l)],u=!0}u||(P=o.__r3f)==null||P.objects.push(n),n.__r3f||re(n,{}),n.__r3f.parent=o,Ae(n),oe(n)}}function c(o,n,f=!1){o&&[...o].forEach(u=>h(n,u,f))}function h(o,n,f){if(n){var u,p,P;if(n.__r3f&&(n.__r3f.parent=null),(u=o.__r3f)!=null&&u.objects&&(o.__r3f.objects=o.__r3f.objects.filter(E=>E!==n)),(p=n.__r3f)!=null&&p.attach)Ze(o,n,n.__r3f.attach);else if(n.isObject3D&&o.isObject3D){var b;o.remove(n),(b=n.__r3f)!=null&&b.root&&hn(n.__r3f.root,n)}const d=(P=n.__r3f)==null?void 0:P.primitive,y=f===void 0?n.dispose!==null&&!d:f;if(!d){var l;c((l=n.__r3f)==null?void 0:l.objects,n,y),c(n.children,n,y)}n.__r3f&&(delete n.__r3f.root,delete n.__r3f.objects,delete n.__r3f.handlers,delete n.__r3f.memoizedProps,d||delete n.__r3f),y&&n.dispose&&n.type!=="Scene"&&qe.unstable_scheduleCallback(qe.unstable_IdlePriority,()=>{try{n.dispose()}catch{}}),oe(o)}}function v(o,n,f,u){var p;const P=(p=o.__r3f)==null?void 0:p.parent;if(!P)return;const b=r(n,f,o.__r3f.root);if(o.children){for(const l of o.children)l.__r3f&&i(b,l);o.children=o.children.filter(l=>!l.__r3f)}o.__r3f.objects.forEach(l=>i(b,l)),o.__r3f.objects=[],o.__r3f.autoRemovedBeforeAppend||h(P,o),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),i(P,b),b.raycast&&b.__r3f.eventCount&&b.__r3f.root.getState().internal.interaction.push(b),[u,u.alternate].forEach(l=>{l!==null&&(l.stateNode=b,l.ref&&(typeof l.ref=="function"?l.ref(b):l.ref.current=b))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Jt({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(o,n)=>{if(!n)return;const f=o.getState().scene;f.__r3f&&(f.__r3f.root=o,i(f,n))},removeChildFromContainer:(o,n)=>{n&&h(o.getState().scene,n)},insertInContainerBefore:(o,n,f)=>{if(!n||!f)return;const u=o.getState().scene;u.__r3f&&a(u,n,f)},getRootHostContext:()=>null,getChildHostContext:o=>o,finalizeInitialChildren(o){var n;return!!((n=o==null?void 0:o.__r3f)!=null?n:{}).handlers},prepareUpdate(o,n,f,u){if(o.__r3f.primitive&&u.object&&u.object!==o)return[!0];{const{args:p=[],children:P,...b}=u,{args:l=[],children:d,...y}=f;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((M,S)=>M!==l[S]))return[!0];const E=ut(o,b,y,!0);return E.changes.length?[!1,E]:null}},commitUpdate(o,[n,f],u,p,P,b){n?v(o,u,P,b):Ce(o,f)},commitMount(o,n,f,u){var p;const P=(p=o.__r3f)!=null?p:{};o.raycast&&P.handlers&&P.eventCount&&o.__r3f.root.getState().internal.interaction.push(o)},getPublicInstance:o=>o,prepareForCommit:()=>null,preparePortalMount:o=>re(o.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(o){var n;const{attach:f,parent:u}=(n=o.__r3f)!=null?n:{};f&&u&&Ze(u,o,f),o.isObject3D&&(o.visible=!1),oe(o)},unhideInstance(o,n){var f;const{attach:u,parent:p}=(f=o.__r3f)!=null?f:{};u&&p&&Me(p,o,u),(o.isObject3D&&n.visible==null||n.visible)&&(o.visible=!0),oe(o)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ce}}var Ue,Ve;const Pe=e=>"colorSpace"in e||"outputColorSpace"in e,ot=()=>{var e;return(e=Ie.ColorManagement)!=null?e:null},it=e=>e&&e.isOrthographicCamera,cn=e=>e&&e.hasOwnProperty("current"),de=typeof window<"u"&&((Ue=window.document)!=null&&Ue.createElement||((Ve=window.navigator)==null?void 0:Ve.product)==="ReactNative")?g.useLayoutEffect:g.useEffect;function st(e){const t=g.useRef(e);return de(()=>void(t.current=e),[e]),t}function un({set:e}){return de(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class at extends g.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}at.getDerivedStateFromError=()=>({error:!0});const lt="__default",Xe=new Map,fn=e=>e&&!!e.memoized&&!!e.changes;function ct(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const le=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const c=I.obj(e);if(c&&i==="reference")return e===t;const h=I.arr(e);if(h&&r==="reference")return e===t;if((h||c)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(c&&r==="shallow"&&i==="shallow"){for(v in a?t:e)if(!I.equ(e[v],t[v],{strict:a,objects:"reference"}))return!1}else for(v in a?t:e)if(e[v]!==t[v])return!1;if(I.und(v)){if(h&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function dn(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function pn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const r=e;return(t!=null&&t.primitive||!r.__r3f)&&(r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function ke(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((c,h)=>c[h],e),{target:r,key:a}}else return{target:r,key:t}}const Ye=/-\d+$/;function Me(e,t,r){if(I.str(r)){if(Ye.test(r)){const c=r.replace(Ye,""),{target:h,key:v}=ke(e,c);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:a}=ke(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function Ze(e,t,r){var i,a;if(I.str(r)){const{target:c,key:h}=ke(e,r),v=t.__r3f.previousAttach;v===void 0?delete c[h]:c[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function ut(e,{children:t,key:r,ref:i,...a},{children:c,key:h,ref:v,...s}={},m=!1){var o;const n=(o=e==null?void 0:e.__r3f)!=null?o:{},f=Object.entries(a),u=[];if(m){const P=Object.keys(s);for(let b=0;b<P.length;b++)a.hasOwnProperty(P[b])||f.unshift([P[b],lt+"remove"])}f.forEach(([P,b])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&P==="object"||I.equ(b,s[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return u.push([P,b,!0,[]]);let d=[];P.includes("-")&&(d=P.split("-")),u.push([P,b,!1,d]);for(const y in a){const E=a[y];y.startsWith(`${P}-`)&&u.push([y,E,!1,y.split("-")])}});const p={...a};return n.memoizedProps&&n.memoizedProps.args&&(p.args=n.memoizedProps.args),n.memoizedProps&&n.memoizedProps.attach&&(p.attach=n.memoizedProps.attach),{memoized:p,changes:u}}function Ce(e,t){var r,i,a;const c=(r=e.__r3f)!=null?r:{},h=c.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:m}=fn(t)?t:ut(e,t),o=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let f=0;f<m.length;f++){let[u,p,P,b]=m[f];if(Pe(e)){const E="srgb",M="srgb-linear";u==="encoding"?(u="colorSpace",p=p===3001?E:M):u==="outputEncoding"&&(u="outputColorSpace",p=p===3001?E:M)}let l=e,d=l[u];if(b.length&&(d=b.reduce((y,E)=>y[E],e),!(d&&d.set))){const[y,...E]=b.reverse();l=E.reverse().reduce((M,S)=>M[S],e),u=y}if(p===lt+"remove")if(l.constructor){let y=Xe.get(l.constructor);y||(y=new l.constructor,Xe.set(l.constructor,y)),p=y[u]}else p=0;if(P)p?c.handlers[u]=p:delete c.handlers[u],c.eventCount=Object.keys(c.handlers).length;else if(d&&d.set&&(d.copy||d instanceof _e)){if(Array.isArray(p))d.fromArray?d.fromArray(p):d.set(...p);else if(d.copy&&p&&p.constructor&&d.constructor===p.constructor)d.copy(p);else if(p!==void 0){const y=d instanceof Dt;!y&&d.setScalar?d.setScalar(p):d instanceof _e&&p instanceof _e?d.mask=p.mask:d.set(p),!ot()&&!v.linear&&y&&d.convertSRGBToLinear()}}else if(l[u]=p,l[u]instanceof xt&&l[u].format===St&&l[u].type===Ot){const y=l[u];Pe(y)&&Pe(v.gl)?y.colorSpace=v.gl.outputColorSpace:y.encoding=v.gl.outputEncoding}oe(e)}if(c.parent&&v.internal&&e.raycast&&o!==c.eventCount){const f=v.internal.interaction.indexOf(e);f>-1&&v.internal.interaction.splice(f,1),c.eventCount&&v.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(a=e.__r3f)!=null&&a.parent&&Ae(e),e}function oe(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Ae(e){e.onUpdate==null||e.onUpdate(e)}function mn(e,t){e.manual||(it(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ge(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function vn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function ft(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function hn(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{ft(r.capturedMap,t,i,a)})}function gn(e){function t(s){const{internal:m}=e.getState(),o=s.offsetX-m.initialClick[0],n=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(o*o+n*n))}function r(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(o=>{var n;return(n=m.__r3f)==null?void 0:n.handlers["onPointer"+o]}))}function i(s,m){const o=e.getState(),n=new Set,f=[],u=m?m(o.internal.interaction):o.internal.interaction;for(let l=0;l<u.length;l++){const d=le(u[l]);d&&(d.raycaster.camera=void 0)}o.previousRoot||o.events.compute==null||o.events.compute(s,o);function p(l){const d=le(l);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var y;d.events.compute==null||d.events.compute(s,d,(y=d.previousRoot)==null?void 0:y.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(l,!0):[]}let P=u.flatMap(p).sort((l,d)=>{const y=le(l.object),E=le(d.object);return!y||!E?l.distance-d.distance:E.events.priority-y.events.priority||l.distance-d.distance}).filter(l=>{const d=ge(l);return n.has(d)?!1:(n.add(d),!0)});o.events.filter&&(P=o.events.filter(P,o));for(const l of P){let d=l.object;for(;d;){var b;(b=d.__r3f)!=null&&b.eventCount&&f.push({...l,eventObject:d}),d=d.parent}}if("pointerId"in s&&o.internal.capturedMap.has(s.pointerId))for(let l of o.internal.capturedMap.get(s.pointerId).values())n.has(ge(l.intersection))||f.push(l.intersection);return f}function a(s,m,o,n){const f=e.getState();if(s.length){const u={stopped:!1};for(const p of s){const P=le(p.object)||f,{raycaster:b,pointer:l,camera:d,internal:y}=P,E=new U(l.x,l.y,0).unproject(d),M=A=>{var w,D;return(w=(D=y.capturedMap.get(A))==null?void 0:D.has(p.eventObject))!=null?w:!1},S=A=>{const w={intersection:p,target:m.target};y.capturedMap.has(A)?y.capturedMap.get(A).set(p.eventObject,w):y.capturedMap.set(A,new Map([[p.eventObject,w]])),m.target.setPointerCapture(A)},k=A=>{const w=y.capturedMap.get(A);w&&ft(y.capturedMap,p.eventObject,w,A)};let T={};for(let A in m){let w=m[A];typeof w!="function"&&(T[A]=w)}let j={...p,...T,pointer:l,intersections:s,stopped:u.stopped,delta:o,unprojectedPoint:E,ray:b.ray,camera:d,stopPropagation(){const A="pointerId"in m&&y.capturedMap.get(m.pointerId);if((!A||A.has(p.eventObject))&&(j.stopped=u.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=s.slice(0,s.indexOf(p));c([...w,p])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:k},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:k},nativeEvent:m};if(n(j),u.stopped===!0)break}}return s}function c(s){const{internal:m}=e.getState();for(const o of m.hovered.values())if(!s.length||!s.find(n=>n.object===o.object&&n.index===o.index&&n.instanceId===o.instanceId)){const f=o.eventObject.__r3f,u=f==null?void 0:f.handlers;if(m.hovered.delete(ge(o)),f!=null&&f.eventCount){const p={...o,intersections:s};u.onPointerOut==null||u.onPointerOut(p),u.onPointerLeave==null||u.onPointerLeave(p)}}}function h(s,m){for(let o=0;o<m.length;o++){const n=m[o].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return m=>{const{internal:o}=e.getState();"pointerId"in m&&o.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{o.capturedMap.has(m.pointerId)&&(o.capturedMap.delete(m.pointerId),c([]))})}}return function(o){const{onPointerMissed:n,internal:f}=e.getState();f.lastEvent.current=o;const u=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",b=i(o,u?r:void 0),l=p?t(o):0;s==="onPointerDown"&&(f.initialClick=[o.offsetX,o.offsetY],f.initialHits=b.map(y=>y.eventObject)),p&&!b.length&&l<=2&&(h(o,f.interaction),n&&n(o)),u&&c(b);function d(y){const E=y.eventObject,M=E.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(u){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const k=ge(y),T=f.hovered.get(k);T?T.stopped&&y.stopPropagation():(f.hovered.set(k,y),S.onPointerOver==null||S.onPointerOver(y),S.onPointerEnter==null||S.onPointerEnter(y))}S.onPointerMove==null||S.onPointerMove(y)}else{const k=S[s];k?(!p||f.initialHits.includes(E))&&(h(o,f.interaction.filter(T=>!f.initialHits.includes(T))),k(y)):p&&f.initialHits.includes(E)&&h(o,f.interaction.filter(T=>!f.initialHits.includes(T)))}}a(b,o,l,d)}}return{handlePointer:v}}const dt=e=>!!(e!=null&&e.render),pt=g.createContext(null),yn=(e,t)=>{const r=tt((v,s)=>{const m=new U,o=new U,n=new U;function f(l=s().camera,d=o,y=s().size){const{width:E,height:M,top:S,left:k}=y,T=E/M;d instanceof U?n.copy(d):n.set(...d);const j=l.getWorldPosition(m).distanceTo(n);if(it(l))return{width:E/l.zoom,height:M/l.zoom,top:S,left:k,factor:1,distance:j,aspect:T};{const A=l.fov*Math.PI/180,w=2*Math.tan(A/2)*j,D=w*(E/M);return{width:D,height:w,top:S,left:k,factor:E/D,distance:j,aspect:T}}}let u;const p=l=>v(d=>({performance:{...d.performance,current:l}})),P=new Lt;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,d)=>t(l,d,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Ft,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();u&&clearTimeout(u),l.performance.current!==l.performance.min&&p(l.performance.min),u=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:l=>v(d=>({...d,events:{...d.events,...l}})),setSize:(l,d,y,E,M)=>{const S=s().camera,k={width:l,height:d,top:E||0,left:M||0,updateStyle:y};v(T=>({size:k,viewport:{...T.viewport,...f(S,o,k)}}))},setDpr:l=>v(d=>{const y=ct(l);return{viewport:{...d.viewport,dpr:y,initialDpr:d.viewport.initialDpr||y}}}),setFrameloop:(l="always")=>{const d=s().clock;d.stop(),d.elapsedTime=0,l!=="never"&&(d.start(),d.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:g.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,d,y)=>{const E=s().internal;return E.priority=E.priority+(d>0?1:0),E.subscribers.push({ref:l,priority:d,store:y}),E.subscribers=E.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=s().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(d>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==l))}}}}}),i=r.getState();let a=i.size,c=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:m,gl:o,set:n}=r.getState();if(s!==a||m.dpr!==c){var f;a=s,c=m.dpr,mn(v,s),o.setPixelRatio(m.dpr);const u=(f=s.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&o.domElement instanceof HTMLCanvasElement;o.setSize(s.width,s.height,u)}v!==h&&(h=v,n(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let ye,bn=new Set,wn=new Set,_n=new Set;function xe(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function ce(e,t){switch(e){case"before":return xe(bn,t);case"after":return xe(wn,t);case"tail":return xe(_n,t)}}let Se,Oe;function Re(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Se=t.internal.subscribers,ye=0;ye<Se.length;ye++)Oe=Se[ye],Oe.ref.current(Oe.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function En(e){let t=!1,r,i,a;function c(s){i=requestAnimationFrame(c),t=!0,r=0,ce("before",s);for(const o of e.values()){var m;a=o.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((m=a.gl.xr)!=null&&m.isPresenting)&&(r+=Re(s,a))}if(ce("after",s),r===0)return ce("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,m=1){var o;if(!s)return e.forEach(n=>h(n.store.getState()),m);(o=s.gl.xr)!=null&&o.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+m),t||(t=!0,requestAnimationFrame(c)))}function v(s,m=!0,o,n){if(m&&ce("before",s),o)Re(s,o,n);else for(const f of e.values())Re(s,f.store.getState());m&&ce("after",s)}return{loop:c,invalidate:h,advance:v}}function mt(){const e=g.useContext(pt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function G(e=r=>r,t){return mt()(e,t)}function He(e,t=0){const r=mt(),i=r.getState().internal.subscribe,a=st(e);return de(()=>i(a,t,r),[t,i,r]),null}function vt(e,t){return function(r,...i){const a=new r;return e&&e(a),Promise.all(i.map(c=>new Promise((h,v)=>a.load(c,s=>{s.scene&&Object.assign(s,dn(s.scene)),h(s)},t,s=>v(new Error(`Could not load ${c}: ${s.message})`))))))}}function pe(e,t,r,i){const a=Array.isArray(t)?t:[t],c=rn(vt(r,i),[e,...a],{equal:I.equ});return Array.isArray(t)?c:c[0]}pe.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return on(vt(r),[e,...i])};pe.clear=function(e,t){const r=Array.isArray(t)?t:[t];return sn([e,...r])};const se=new Map,{invalidate:Ke,advance:Je}=En(se),{reconciler:be,applyProps:X}=ln(se,vn),ne={objects:"shallow",strict:!1},Pn=(e,t)=>{const r=typeof e=="function"?e(t):e;return dt(r)?r:new zt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Mn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:a,left:c}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:a,left:c}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Cn(e){const t=se.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,c=i||yn(Ke,Je),h=r||be.createContainer(c,ie.ConcurrentRoot,null,!1,null,"",a,null);t||se.set(e,{fiber:h,store:c});let v,s=!1,m;return{configure(o={}){let{gl:n,size:f,scene:u,events:p,onCreated:P,shadows:b=!1,linear:l=!1,flat:d=!1,legacy:y=!1,orthographic:E=!1,frameloop:M="always",dpr:S=[1,2],performance:k,raycaster:T,camera:j,onPointerMissed:A}=o,w=c.getState(),D=w.gl;w.gl||w.set({gl:D=Pn(n,e)});let B=w.raycaster;B||w.set({raycaster:B=new Rt});const{params:Y,...H}=T||{};if(I.equ(H,B,ne)||X(B,{...H}),I.equ(Y,B.params,ne)||X(B,{params:{...B.params,...Y}}),!w.camera||w.camera===m&&!I.equ(m,j,ne)){m=j;const R=j instanceof It,O=R?j:E?new Le(0,0,0,0,.1,1e3):new Fe(75,0,.1,1e3);R||(O.position.z=5,j&&X(O,j),!w.camera&&!(j!=null&&j.rotation)&&O.lookAt(0,0,0)),w.set({camera:O})}if(!w.scene){let R;u instanceof Ge?R=u:(R=new Ge,u&&X(R,u)),w.set({scene:re(R)})}if(!w.xr){const R=(L,V)=>{const $=c.getState();$.frameloop!=="never"&&Je(L,!0,$,V)},O=()=>{const L=c.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?R:null),L.gl.xr.isPresenting||Ke(L)},W={connect(){const L=c.getState().gl;L.xr.addEventListener("sessionstart",O),L.xr.addEventListener("sessionend",O)},disconnect(){const L=c.getState().gl;L.xr.removeEventListener("sessionstart",O),L.xr.removeEventListener("sessionend",O)}};D.xr&&W.connect(),w.set({xr:W})}if(D.shadowMap){const R=D.shadowMap.enabled,O=D.shadowMap.type;if(D.shadowMap.enabled=!!b,I.boo(b))D.shadowMap.type=Ee;else if(I.str(b)){var q;const W={basic:Ht,percentage:Wt,soft:Ee,variance:Bt};D.shadowMap.type=(q=W[b])!=null?q:Ee}else I.obj(b)&&Object.assign(D.shadowMap,b);(R!==D.shadowMap.enabled||O!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}const F=ot();F&&("enabled"in F?F.enabled=!y:"legacyMode"in F&&(F.legacyMode=y)),X(D,{outputEncoding:l?3e3:3001,toneMapping:d?jt:Tt}),w.legacy!==y&&w.set(()=>({legacy:y})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==d&&w.set(()=>({flat:d})),n&&!I.fun(n)&&!dt(n)&&!I.equ(n,D,ne)&&X(D,n),p&&!w.events.handlers&&w.set({events:p(c)});const C=Mn(e,f);return I.equ(C,w.size,ne)||w.setSize(C.width,C.height,C.updateStyle,C.top,C.left),S&&w.viewport.dpr!==ct(S)&&w.setDpr(S),w.frameloop!==M&&w.setFrameloop(M),w.onPointerMissed||w.set({onPointerMissed:A}),k&&!I.equ(k,w.performance,ne)&&w.set(R=>({performance:{...R.performance,...k}})),v=P,s=!0,this},render(o){return s||this.configure(),be.updateContainer(g.createElement(xn,{store:c,children:o,onCreated:v,rootElement:e}),h,null,()=>{}),c},unmount(){ht(e)}}}function xn({store:e,children:t,onCreated:r,rootElement:i}){return de(()=>{const a=e.getState();a.set(c=>({internal:{...c.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),g.createElement(pt.Provider,{value:e},t)}function ht(e,t){const r=se.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),be.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var c,h,v,s;a.events.disconnect==null||a.events.disconnect(),(c=a.gl)==null||(h=c.renderLists)==null||h.dispose==null||h.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),pn(a),se.delete(e),t&&t(e)}catch{}},500)})}}be.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:g.version});const je={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Sn(e){const{handlePointer:t}=gn(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(je).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:c}=e.getState();c.disconnect==null||c.disconnect(),a(h=>({events:{...h.events,connected:r}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([h,v])=>{const[s,m]=je[h];r.addEventListener(s,v,{passive:m})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([c,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=je[c];i.connected.removeEventListener(v,h)}}),r(c=>({events:{...c.events,connected:void 0}}))}}}}const On=g.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:c,events:h=Sn,eventSource:v,eventPrefix:s,shadows:m,linear:o,flat:n,legacy:f,orthographic:u,frameloop:p,dpr:P,performance:b,raycaster:l,camera:d,onPointerMissed:y,onCreated:E,...M},S){g.useMemo(()=>an($t),[]);const k=Kt(),[T,j]=Yt({scroll:!0,debounce:{scroll:50,resize:0},...i}),A=g.useRef(null),w=g.useRef(null);g.useImperativeHandle(S,()=>A.current);const D=st(y),[B,Y]=g.useState(!1),[H,q]=g.useState(!1);if(B)throw B;if(H)throw H;const F=g.useRef(null);de(()=>{const x=A.current;j.width>0&&j.height>0&&x&&(F.current||(F.current=Cn(x)),F.current.configure({gl:c,events:h,shadows:m,linear:o,flat:n,legacy:f,orthographic:u,frameloop:p,dpr:P,performance:b,raycaster:l,camera:d,size:j,onPointerMissed:(...C)=>D.current==null?void 0:D.current(...C),onCreated:C=>{C.events.connect==null||C.events.connect(v?cn(v)?v.current:v:w.current),s&&C.setEvents({compute:(R,O)=>{const W=R[s+"X"],L=R[s+"Y"];O.pointer.set(W/O.size.width*2-1,-(L/O.size.height)*2+1),O.raycaster.setFromCamera(O.pointer,O.camera)}}),E==null||E(C)}}),F.current.render(g.createElement(k,null,g.createElement(at,{set:q},g.createElement(g.Suspense,{fallback:g.createElement(un,{set:Y})},t)))))}),g.useEffect(()=>{const x=A.current;if(x)return()=>ht(x)},[]);const _=v?"none":"auto";return g.createElement("div",fe({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:_,...a}},M),g.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},g.createElement("canvas",{ref:A,style:{display:"block"}},r)))}),Zn=g.forwardRef(function(t,r){return g.createElement(Zt,null,g.createElement(On,fe({},t,{ref:r})))}),me=new U,We=new U,Rn=new U;function jn(e,t,r){const i=me.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,c=r.height/2;return[i.x*a+a,-(i.y*c)+c]}function Tn(e,t){const r=me.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),c=t.getWorldDirection(Rn);return a.angleTo(c)>Math.PI/2}function kn(e,t,r,i){const a=me.setFromMatrixPosition(e.matrixWorld),c=a.clone();c.project(t),r.setFromCamera(c,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return a.distanceTo(r.ray.origin)<v}return!0}function An(e,t){if(t instanceof Le)return t.zoom;if(t instanceof Fe){const r=me.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,c=r.distanceTo(i);return 1/(2*Math.tan(a/2)*c)}else return 1}function Dn(e,t,r){if(t instanceof Fe||t instanceof Le){const i=me.setFromMatrixPosition(e.matrixWorld),a=We.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(a),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*c+v)}}const De=e=>Math.abs(e)<1e-10?0:e;function gt(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=De(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Ln=(e=>t=>gt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Fn=(e=>(t,r)=>gt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function zn(e){return e&&typeof e=="object"&&"current"in e}const Kn=g.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:c,fullscreen:h,portal:v,distanceFactor:s,sprite:m=!1,transform:o=!1,occlude:n,onOcclude:f,castShadow:u,receiveShadow:p,material:P,geometry:b,zIndexRange:l=[16777271,0],calculatePosition:d=jn,as:y="div",wrapperClass:E,pointerEvents:M="auto",...S},k)=>{const{gl:T,camera:j,scene:A,size:w,raycaster:D,events:B,viewport:Y}=G(),[H]=g.useState(()=>document.createElement(y)),q=g.useRef(),F=g.useRef(null),_=g.useRef(0),x=g.useRef([0,0]),C=g.useRef(null),R=g.useRef(null),O=(v==null?void 0:v.current)||B.connected||T.domElement.parentNode,W=g.useRef(null),L=g.useRef(!1),V=g.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&zn(n[0]),[n]);g.useLayoutEffect(()=>{const N=T.domElement;n&&n==="blending"?(N.style.zIndex=`${Math.floor(l[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[n]),g.useLayoutEffect(()=>{if(F.current){const N=q.current=Qt(H);if(A.updateMatrixWorld(),o)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=d(F.current,j,w);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return O&&(a?O.prepend(H):O.appendChild(H)),()=>{O&&O.removeChild(H),N.unmount()}}},[O,o]),g.useLayoutEffect(()=>{E&&(H.className=E)},[E]);const $=g.useMemo(()=>o?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,c,h,w,o]),ee=g.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);g.useLayoutEffect(()=>{if(L.current=!1,o){var N;(N=q.current)==null||N.render(g.createElement("div",{ref:C,style:$},g.createElement("div",{ref:R,style:ee},g.createElement("div",{ref:k,className:i,style:r,children:e}))))}else{var z;(z=q.current)==null||z.render(g.createElement("div",{ref:k,style:$,className:i,children:e}))}});const te=g.useRef(!0);He(N=>{if(F.current){j.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const z=o?x.current:d(F.current,j,w);if(o||Math.abs(_.current-j.zoom)>t||Math.abs(x.current[0]-z[0])>t||Math.abs(x.current[1]-z[1])>t){const K=Tn(F.current,j);let Z=!1;V&&(n!=="blending"?Z=[A]:Array.isArray(n)&&(Z=n.map(J=>J.current)));const ae=te.current;if(Z){const J=kn(F.current,j,D,Z);te.current=J&&!K}else te.current=!K;ae!==te.current&&(f?f(!te.current):H.style.display=te.current?"block":"none");const ve=Math.floor(l[0]/2),bt=n?V?[l[0],ve]:[ve-1,0]:l;if(H.style.zIndex=`${Dn(F.current,j,bt)}`,o){const[J,$e]=[w.width/2,w.height/2],we=j.projectionMatrix.elements[5]*$e,{isOrthographicCamera:Ne,top:wt,left:_t,bottom:Et,right:Pt}=j,Mt=Ln(j.matrixWorldInverse),Ct=Ne?`scale(${we})translate(${De(-(Pt+_t)/2)}px,${De((wt+Et)/2)}px)`:`translateZ(${we}px)`;let Q=F.current.matrixWorld;m&&(Q=j.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(F.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),H.style.width=w.width+"px",H.style.height=w.height+"px",H.style.perspective=Ne?"":`${we}px`,C.current&&R.current&&(C.current.style.transform=`${Ct}${Mt}translate(${J}px,${$e}px)`,R.current.style.transform=Fn(Q,1/((s||10)/400)))}else{const J=s===void 0?1:An(F.current,j)*s;H.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${J})`}x.current=z,_.current=j.zoom}}if(!V&&W.current&&!L.current)if(o){if(C.current){const z=C.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:K}=j;if(K||b)S.scale&&(Array.isArray(S.scale)?S.scale instanceof U?W.current.scale.copy(S.scale.clone().divideScalar(1)):W.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):W.current.scale.setScalar(1/S.scale));else{const Z=(s||10)/400,ae=z.clientWidth*Z,ve=z.clientHeight*Z;W.current.scale.set(ae,ve,1)}L.current=!0}}}else{const z=H.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const K=1/Y.factor,Z=z.clientWidth*K,ae=z.clientHeight*K;W.current.scale.set(Z,ae,1),L.current=!0}W.current.lookAt(N.camera.position)}});const Be=g.useMemo(()=>({vertexShader:o?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[o]);return g.createElement("group",fe({},S,{ref:F}),n&&!V&&g.createElement("mesh",{castShadow:u,receiveShadow:p,ref:W},b||g.createElement("planeGeometry",null),P||g.createElement("shaderMaterial",{side:Nt,vertexShader:Be.vertexShader,fragmentShader:Be.fragmentShader})))});let ue=0;const Jn=tt(e=>(he.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-ue)/(i-ue)*100})},he.onLoad=()=>{e({active:!1})},he.onError=t=>e(r=>({errors:[...r.errors,t]})),he.onProgress=(t,r,i)=>{r===i&&(ue=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-ue)/(i-ue)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Qe=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function yt(e,t){const r=G(a=>a.gl),i=pe(ze,Qe(e)?Object.values(e):e);if(g.useLayoutEffect(()=>{t==null||t(i)},[t]),g.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),Qe(e)){const a=Object.keys(e),c={};return a.forEach(h=>Object.assign(c,{[h]:i[a.indexOf(h)]})),c}else return i}yt.preload=e=>pe.preload(ze,e);yt.clear=e=>pe.clear(ze,e);function In(e){return Array.isArray(e)}function Te(e=[0,0,0]){return In(e)?e:e instanceof U||e instanceof et?[e.x,e.y,e.z]:[e,e,e]}const Qn=g.forwardRef(function({debug:t,mesh:r,children:i,position:a,rotation:c,scale:h,...v},s){const m=g.useRef(null);g.useImperativeHandle(s,()=>m.current);const o=g.useRef(null);return g.useLayoutEffect(()=>{const n=(r==null?void 0:r.current)||m.current.parent,f=m.current;if(!(n instanceof Gt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const u={position:new U,rotation:new et,scale:new U(1,1,1)};if(n){X(u,{position:a,scale:h});const p=n.matrixWorld.clone();if(n.matrixWorld.identity(),!c||typeof c=="number"){const P=new qt;P.position.copy(u.position),P.lookAt(n.position),typeof c=="number"&&P.rotateZ(c),X(u,{rotation:P.rotation})}else X(u,{rotation:c});return f.geometry=new en(n,u.position,u.rotation,u.scale),o.current&&X(o.current,u),n.matrixWorld=p,()=>{f.geometry.dispose()}}},[r,...Te(a),...Te(h),...Te(c)]),g.createElement("mesh",{ref:m},i||g.createElement("meshStandardMaterial",fe({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},v)),t&&g.createElement("mesh",{ref:o},g.createElement("boxGeometry",null),g.createElement("meshNormalMaterial",{wireframe:!0}),g.createElement("axesHelper",null)))}),er=g.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:a=!0,onChange:c,onStart:h,onEnd:v,...s},m)=>{const o=G(M=>M.invalidate),n=G(M=>M.camera),f=G(M=>M.gl),u=G(M=>M.events),p=G(M=>M.setEvents),P=G(M=>M.set),b=G(M=>M.get),l=G(M=>M.performance),d=t||n,y=i||u.connected||f.domElement,E=g.useMemo(()=>new tn(d),[d]);return He(()=>{E.enabled&&E.update()},-1),g.useEffect(()=>(E.connect(y),()=>void E.dispose()),[y,r,E,o]),g.useEffect(()=>{const M=T=>{o(),r&&l.regress(),c&&c(T)},S=T=>{h&&h(T)},k=T=>{v&&v(T)};return E.addEventListener("change",M),E.addEventListener("start",S),E.addEventListener("end",k),()=>{E.removeEventListener("start",S),E.removeEventListener("end",k),E.removeEventListener("change",M)}},[c,h,v,E,o,p]),g.useEffect(()=>{if(e){const M=b().controls;return P({controls:E}),()=>P({controls:M})}},[e,E]),g.createElement("primitive",fe({ref:m,object:E,enableDamping:a},s))}),tr=g.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:a=1,floatingRange:c=[-.1,.1],...h},v)=>{const s=g.useRef(null),m=g.useRef(Math.random()*1e4);return He(o=>{var n,f;if(!t||r===0)return;const u=m.current+o.clock.getElapsedTime();s.current.rotation.x=Math.cos(u/4*r)/8*i,s.current.rotation.y=Math.sin(u/4*r)/8*i,s.current.rotation.z=Math.sin(u/4*r)/20*i;let p=Math.sin(u/4*r)/10;p=Ut.mapLinear(p,-.1,.1,(n=c==null?void 0:c[0])!==null&&n!==void 0?n:-.1,(f=c==null?void 0:c[1])!==null&&f!==void 0?f:.1),s.current.position.y=p*a,s.current.updateMatrix()}),g.createElement("group",h,g.createElement("group",{ref:nn([s,v]),matrixAutoUpdate:!1},e))});function nr({all:e,scene:t,camera:r}){const i=G(({gl:h})=>h),a=G(({camera:h})=>h),c=G(({scene:h})=>h);return g.useLayoutEffect(()=>{const h=[];e&&(t||c).traverse(m=>{m.visible===!1&&(h.push(m),m.visible=!0)}),i.compile(t||c,r||a);const v=new Vt(128);new Xt(.01,1e5,v).update(i,t||c),v.dispose(),h.forEach(m=>m.visible=!1)},[]),null}export{Zn as C,Qn as D,tr as F,Kn as H,er as O,nr as P,yt as a,Jn as u};
